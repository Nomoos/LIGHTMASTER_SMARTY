<?php$option['modul'] = fetch_array(query("SELECT `id`, `nazev` FROM `modul` WHERE `druh`='main' ORDER BY `poradi`"),"id");$smarty->assign("option", $option);if ($_GET['id']) {    $edit_id = intval($_GET['id']);    $edit = fetch_assoc(query("            SELECT m.*, mm.`page` AS modul_page            FROM `modul` AS m            LEFT JOIN `modul` AS mm ON (mm.`id` = m.`modul_id`)            WHERE m.`id`='{$edit_id}'"));    $smarty->assign("edit", $edit);}if ($_POST['submitValue'] == 'new') {    if ($_POST['def']['nazev'] == '' OR $_POST['def']['page'] == '') {        $err[] = "Musíte vyplnit všechny povinné položky.";    }    if ($err) {        $smarty->assign("err", $err);    } else {        $inp = poster($_POST['def'], "db_set");        if (!is_null($edit['modul_id'])) {            $inp['db_set'][] = "`url`='{$edit['modul_page']}/{$_POST['def']['page']}.html'";        }        if ($_POST['zobraz']) {            $inp['db_set'][] = "`zobraz`='2'";        } else {            $inp['db_set'][] = "`zobraz`='0'";        }        query("START TRANSACTION");        if (!query("UPDATE `modul` SET " . implode(",", $inp['db_set']) . " WHERE `id`='{$edit_id}'")) {            $db_err[] = "Chyba pri ukladani modulu";        }        if (($edit['druh'] == 'main')) {            $subModul_sql = query("SELECT `id`, `page` FROM `modul` WHERE `modul_id`='{$edit_id}' AND `druh`='sub'");            while($it = fetch_assoc($subModul_sql)){                if(!query("UPDATE `modul` SET `url`='{$_POST['def']['page']}/{$it['page']}.html' WHERE `id`='{$it['id']}'")){                    $db_err[] = "Chyba pri prepisu submodulu";                }            }        }        if ($db_err) {            query("ROLLBACK");            $smarty->assign("err", "Při ukládání se vyskytla chyba.");        } else {            query("COMMIT");            go($setup['adm']['www'] . "nastaveni/seznamModul.html");        }    }}?>