<?phpif ($_SESSION['user']['admin'] == '0') {    $whereOpravneni = " WHERE `admin`='0'";}$option['opravneni'] = fetch_array(query("SELECT `id`, `nazev` FROM `uzivatelOpravneni` {$whereOpravneni}"), "id");$smarty->assign("option", $option);$id = intval($_GET['id']);$user = fetch_assoc(query("SELECT `id`, `login`, `jmeno`, `prijmeni`, `email`, `uzivatelOpravneni_id`, `blokace` FROM `uzivatel_vw` WHERE `id`='{$id}'"));$smarty->assign("user", $user);if ($_POST['edit']) {    if (!$_POST['login']) {        $err['info'][] = "Není vyplněno přihlašovací jméno.";    }    if($option['opravneni'][$_POST['uzivatelOpravneni_id']]['domena'] != 2){        if (!$_POST['jmeno']) {            $err['info'][] = "Není vyplněno jméno.";        }        if (!$_POST['prijmeni']) {            $err['info'][] = "Není vyplněno příjmení.";        }    }    if ($_POST['login']) {        $db_user = fetch_assoc(query("SELECT `login` FROM `uzivatel` WHERE `login` = '{$_POST['login']}' AND `id`!='{$id}'"));        if ($db_user) {            $err['info'][] = "Uživatelské jméno - &bdquo;" . $_POST['login'] . "&rdquo; je již použito, zvolte jiné !";        }    }    if (!$err) {        $inp[] = "`login`='" . addslashes($_POST['login']) . "'";        $inp[] = "`jmeno`='" . addslashes($_POST['jmeno']) . "'";        $inp[] = "`prijmeni`='" . addslashes($_POST['prijmeni']) . "'";        if ($_POST['jmeno'] OR $_POST['prijmeni']) {            $inp[] = "`nick`='" . addslashes($_POST['jmeno']) . " " . addslashes($_POST['prijmeni']) . "'";        }        $inp[] = "`email`='" . addslashes($_POST['email']) . "'";        $inp[] = "`uzivatelOpravneni_id`='" . addslashes($_POST['uzivatelOpravneni_id']) . "'";        if ($_POST['blokace'] == 2) {            $inp[] = "`blokace`='2'";            $inp[] = "`duvodBlokace`='Uživatel je zablokován.'";        } else {            $inp[] = "`blokace`='0'";            $inp[] = "`duvodBlokace`=''";        }        if (query("UPDATE `uzivatel` SET " . implode(",", $inp) . " WHERE `id`='{$id}'")) {            go($setup['adm']['www'] . "uzivatele/seznam.html");        }    } else {        $smarty->assign("err", $err);    }}if ($_POST['change_pass']) {    if (!$_POST['password'])        $err['pass'][] = "Není vyplněno heslo.";    if ($_POST['password'] != $_POST['password_again']) {        $err['pass'][] = "Hesla se neshodují.";    }    if (strlen($_POST['password']) < "4") {        $err['pass'][] = "Délka hesla musí být minimálně 4 znaky.";    }    if (!$err) {        $password = $_POST['password'];        $heslo = sha1($id . $password);        $res = query("UPDATE `uzivatel` SET `password`='{$heslo}' WHERE `id`='{$id}'");        if ($res) {            go($setup['adm']['www'] . "uzivatele/seznam.html");        }    } else {        $smarty->assign("err", $err);    }}?>