<?phpif(!isset($_SESSION['filter']['company'])) {    go($setup['adm']['www'].'companies/list.html');}if ($_POST['submitValue'] == 'new') {    if (!$_POST['controlname']) {        $err[] = "NOTFILLCONTROLNAME";    }    if (!$_POST['controlip']) {        $err[] = "NOTFILLCONTROLIP";    }    if (!$_POST['area']) {        $err[] = "NOTFILLAREA";    }    if (!$err) {        if (!query("INSERT INTO control_gateway (`area_ID_area`, `control_name`, `ipcontrol`) VALUES ('".$_SESSION['filter']['area']."', '".$_POST['controlname']."', '".$_POST['controlip']."');")) {            $err[] = "FAULTINDBINSERT";            $smarty->assign("err", $err);        }else{            $list_sql = query("SELECT ID_control FROM control_gateway WHERE area_ID_area=".$_SESSION['filter']['area']." ORDER BY ID_control DESC  limit 1;");            $id = fetch_array($list_sql);            $id = $id[0]['ID_control'];            go($setup['adm']['www'].'controls/edit.html?control='.$id);        }    } else {        $smarty->assign("err", $err);    }}if(isset($_POST['area'])) {    $area = $_POST['area'];}else if(isset($_SESSION['filter']['area'])){    $area = $_SESSION['filter']['area'];}else{    $area = 0;}$smarty->assign("area", $area);//choice area$_SESSION['user']['interid'] = 22;if (isset($_SESSION['filter']['company'])) {    $rule_sql = query("    SELECT  rule_access.is_admin,rule_access.is_member,rule_access.edit_company,rule_access.edit_area,rule_access.edit_control,rule_access.edit_lamp FROM `users`LEFT OUTER JOIN rule_access ON rule_access.users_id = users.idLEFT OUTER JOIN company ON company.ID_company = rule_access.company_ID_companyWHERE users.id=".$_SESSION['user']['interid']." AND rule_access.company_ID_company=".$_SESSION['filter']['company'].";");    $list_sql = query("    SELECT * FROM area WHERE company_ID_company =" . $_SESSION['filter']['company']    );}$areasList = fetch_array($list_sql,'ID_area');$smarty->assign("areasList", $areasList);?>