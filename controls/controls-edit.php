<?phpif(isset($_GET['control']) or isset($_POST['control'])) {    $_POST['control'] = $_GET['control'];    if ($_POST['submitValue'] == 'edit') {        if (!$_POST['area']) {            $err[] = _("SELECTAREA");        }        if (!$_POST['controlname']) {            $err[] = _("YOUDONTFILLCONTROLNAME");        }        if (!$_POST['controlip']) {            $err[] = _("YOUDONTFILLCONTROLIP");        }        if (!$err) {            if (!query("UPDATE control_gateway SET `area_ID_area`='".$_POST['area']."', `control_name`='".$_POST['controlname']."', `ipcontrol`='".$_POST['controlip']."' WHERE `ID_control`='".$_POST['control']."';")) {                $db_err[] = _("ERRORWHENISAVEAREATODB");                $smarty->assign("db_err", $db_err);            } else {                $msg[] = _("AREASUCCESFULYSAVETODB");            }        } else {            $smarty->assign("err", $err);        }    }elseif ($_POST['submitValue'] == 'delete') {        $list_sql = query("SELECT COUNT(*) AS rows FROM lamps WHERE control_gateway_ID_control ='".$_POST['control']."';");        if (!$list_sql){            $db_err[] = "DBSELECTLAMPERROR";            $smarty->assign("err", $db_err);        }else {            $result = fetch_array($list_sql);            $rows = $result[0];            $rows = $rows['rows'];            if($rows <= 0){                if (!query("DELETE FROM control_gateway WHERE ID_control='" . $_POST['control'] . "';")) {                    $db_err[] = "DBDELETEERROR";                    $smarty->assign("err", $db_err);                } else {                    go($setup['adm']['www'] . 'controls/list.html');                }            }else{                $err[] = "CONTROLHAVELAMPS";                $smarty->assign("err", $err);            }        }    }else{        $list_sql = query("SELECT area_id_area,control_name,ipcontrol FROM control_gateway WHERE ID_control=".$_GET['control'].";");        $result = fetch_array($list_sql);        $control = $result[0];        $_POST['controlname'] = $control['control_name'];        $_POST['controlip'] = $control['ipcontrol'];        $_POST['area'] = $control['area_id_area'];    }    $smarty->assign('area',$_POST['area']);    $smarty->assign('controlname',$_POST['controlname']);    $smarty->assign('control',$_POST['control']);    $smarty->assign('controlip',$_POST['controlip']);//choice area    $_SESSION['user']['interid'] = 22;    if (isset($_SESSION['filter']['company'])) {        $rule_sql = query("    SELECT  rule_access.is_admin,rule_access.is_member,rule_access.edit_company,rule_access.edit_area,rule_access.edit_control,rule_access.edit_lamp FROM `users`LEFT OUTER JOIN rule_access ON rule_access.users_id = users.idLEFT OUTER JOIN company ON company.ID_company = rule_access.company_ID_companyWHERE users.id=".$_SESSION['user']['interid']." AND rule_access.company_ID_company=".$_SESSION['filter']['company'].";");        $list_sql = query("    SELECT * FROM area WHERE company_ID_company =" . $_SESSION['filter']['company']        );    }    $areasList = fetch_array($list_sql,'ID_area');    $smarty->assign("areasList", $areasList);}else{    go($setup['adm']['www'].'controls/list.html');}?>